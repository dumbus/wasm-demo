# WASM-demo

## Демонстрация работы WebAssembly с использованием компилятора [Emscripten](https://emscripten.org/).

### Принцип работы приложения:

1. Пользователь загружает BMP-изображение через `<input type="file">`.
2. Браузер читает файл как массив байтов (`Uint8Array`).
3. Массив байтов передаётся в память WebAssembly-модуля, написанного на языке C.
4. WASM-модуль инвертирует цвета для каждого байта изображения.
5. После завершения обработки, новый массив байтов (с инвертированными цветами) считывается обратно из WASM-памяти.
6. Таймер измеряет время обработки (performance.now() до и после вызова WASM-кода).
7. Отображается время, затраченное на обработку изображения.

> В процессе работы программы на экран выводится исходное, а также обработанное изображение.


### Как протестировать приложение:

1. Установить компилятор [Emscripten](https://emscripten.org/). Убедиться, что компилятор установлен корректно, можно с помощью команды:
```
emcc -v
```
2. Скомпилировать приложение с помощью следующей команды:
```
emcc cpp/invert.cpp -o compiled/invert.js -sEXPORTED_FUNCTIONS="['_analyze_image', '_invert_colors', '_malloc', '_free']" -sEXPORTED_RUNTIME_METHODS="['ccall', 'cwrap', 'HEAPU8']" -sALLOW_MEMORY_GROWTH
```
В результате будет получено 2 файла:
  * `compiled/invert.js` - JavaScript-обёртка, которая позволит работать с C-кодом WebAssembly через обычные вызовы в JavaScript коде
  * `compiled/invert.wasm` - собранный бинарник WebAssembly, в котором находится вся логика, описанная в `cpp/invert.cpp`, представленная в оптимизированной форме, которая может быть обработана браузером.
3. Запустить приложение на локальном сервере:
```
python -m http.server 8080
```
4. Открыть запущенное приложение по адресу:
```
http://localhost:8080
```

### Дополнительно: 

Если `emcc` не был добавлен в системные переменные, перед компиляцией следует выполнить следующие команды:

> `C:\emsdk\emsdk` следует заменить на путь до скачанного Вами компилятора

1. Скачать и установить последнюю версию Emscripten SDK (компилятор + инструменты):
```
C:\emsdk\emsdk install latest
```
2. Активировать установленную версию SDK:
```
C:\emsdk\emsdk activate latest
```
3. Загрузить переменные окружения в текущую PowerShell-сессию:
```
C:\emsdk\emsdk_env.ps1
```